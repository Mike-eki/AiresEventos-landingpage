<!-- ---
import ArrowDown from '../icons/ArrowDown.astro';
---

<section id="hero">
    <div class="circle-container">
        <svg viewBox="0 0 100 100">
            <defs>
                <path id="circle" d="
                    M 50, 50
                    m -37, 0
                    a 37,37 0 1,1 74,0
                    a 37,37 0 1,1 -74,0"
                />
            </defs>
            <text 
                textLength="230"
                lengthAdjust="spacingAndGlyphs"
            >
                 <textPath href="#circle" >
                    Donde los momentos cobran vida • Donde los momentos cobran vida •
                </textPath>
            </text>
        </svg>
    </div>
    <button id="scroll-button" class="button-hero"><ArrowDown /></button>
    <video autoplay muted loop>
        <source src="videos/hero_video.mp4" type="video/mp4" />
    </video>
</section>

<style>
    section {
        position: relative;
    }
    .circle-container {
        position: absolute;
        top: 80%;
        left: 50%;
        transform: translate(-50%, -50%);

        width: 12rem;
        height: 12rem;

        z-index: 15;
    }
    svg {
        shape-rendering: geometricPrecision;

        position: absolute;
        top: 0; left: 0;
        width: 100%;
        height: 100%;
        transform-origin: center;
    }

    @keyframes rotate {
        from {
            transform: rotate(0deg);
        }
        to {
            transform: rotate(360deg);
        }
    }

    text {
        will-change: transform;
        transform: translateZ(0);   /* crea una capa propia */
        text-rendering: optimizeLegibility;


        animation: rotate 20s linear infinite;
        transform-origin: 50% 50%;
        fill: var(--light-beige);
        font-family: var(--font-switzer-light);
        font-size: 6px;
    }

    button {
        position: absolute;
        top: 80%;
        left: 50%;
        transform: translate(-50%, -50%);

        border-radius: 10rem;
        border: none;
        width: 4rem;
        height: 6.5rem;
        cursor: pointer;

        z-index: 20;
        
        transition: transform 0.2s ease;
    }

    button:hover {
        transform: translate(-50%, -50%) scale(1.05);
    }

    button:active {
        transform: translate(-50%, -50%) scale(0.95);
    }

    video {
        display: block;

        width: 100%;
        height: 100vh;
        height: 100dvh;

        margin: 0;
        padding: 0;

        object-fit: cover;
        z-index: 10;
    }
</style>

<script>
  import { gsap } from 'gsap';
  import { ScrollToPlugin } from 'gsap/ScrollToPlugin';
  
  // Registrar el plugin
  gsap.registerPlugin(ScrollToPlugin);
  
  // Esperar a que el DOM esté listo
  document.addEventListener('DOMContentLoaded', () => {
    const button = document.getElementById('scroll-button');
    
    if (button) {
      button.addEventListener('click', () => {
        // Timeline para coordinar las animaciones
        const tl = gsap.timeline();
        
        // Pequeña animación del botón al hacer click
        tl.to(button, {
          scale: 0.9,
          duration: 0.15,
          ease: 'power2.out'
        })
        .to(button, {
          scale: 1,
          duration: 0.15,
          ease: 'power2.out'
        })
        // Scroll suave hacia la sección intro
        .to(window, {
          duration: 0.15,
          scrollTo: {
            y: '#intro',
            offsetY: 0
          },
          ease: 'power3.inOut'
        }, '-=0.1'); // Pequeño overlap para fluidez
      });
    }
  });
</script> -->


---
import ArrowDown from '../icons/ArrowDown.astro';
---

<section id="hero">
    <div class="circle-container">
        <svg width="192" height="192" viewBox="0 0 100 100">
            <defs>
                <path id="circle" d="
                    M 50, 50
                    m -37, 0
                    a 37,37 0 1,1 74,0
                    a 37,37 0 1,1 -74,0"
                />
            </defs>
            <text 
                textLength="235"
            >
                <textPath href="#circle" startOffset="0">
                    Donde los momentos cobran vida • Donde los momentos cobran vida •
                </textPath>
            </text>
        </svg>
    </div>
    <button id="scroll-button" class="button-hero"><ArrowDown /></button>
    <video autoplay muted loop>
        <source src="videos/hero_video.mp4" type="video/mp4" />
    </video>
</section>

<style>
    section {
        position: relative;
        overflow: hidden; /* Prevenir cualquier desbordamiento */
    }
    .circle-container {
        position: absolute;
        top: 80%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 12rem; /* 192px */
        height: 12rem;
        display: flex; /* Añadir flex para centrado robusto */
        justify-content: center;
        align-items: center;
        z-index: 15;
    }
    svg {
        shape-rendering: geometricPrecision;
        width: 100%;
        height: 100%;
        transform-origin: center;
    }

    @keyframes rotate {
        from {
            transform: rotate(0deg);
        }
        to {
            transform: rotate(360deg);
        }
    }

    text {
        will-change: transform;
        text-rendering: optimizeLegibility;
        animation: rotate 20s linear infinite;
        transform-origin: center center; /* Especificar explícitamente */
        fill: var(--light-beige);
        font-family: var(--font-switzer-light);
        font-size: 6px;
    }

    button {
        position: absolute;
        top: 80%;
        left: 50%;
        transform: translate(-50%, -50%);
        border-radius: 10rem;
        border: none;
        width: 4rem;
        height: 6.5rem;
        cursor: pointer;
        z-index: 20;
        transition: transform 0.2s ease;
    }

    button:hover {
        transform: translate(-50%, -50%) scale(1.05);
    }

    button:active {
        transform: translate(-50%, -50%) scale(0.95);
    }

    video {
        display: block;
        width: 100%;
        height: 100vh;
        height: 100dvh;
        margin: 0;
        padding: 0;
        object-fit: cover;
        z-index: 10;
    }

    /* Añadir prefijos para compatibilidad con WebKit */
    @supports (-webkit-transform: translate(-50%, -50%)) {
        .circle-container {
            -webkit-transform: translate(-50%, -50%);
        }
        text {
            -webkit-transform-origin: center center;
        }
    }
</style>

<script>
    import { gsap } from 'gsap';
    import { ScrollToPlugin } from 'gsap/ScrollToPlugin';
    
    gsap.registerPlugin(ScrollToPlugin);
    
    document.addEventListener('DOMContentLoaded', () => {
        const button = document.getElementById('scroll-button');
        
        if (button) {
            button.addEventListener('click', () => {
                const tl = gsap.timeline();
                
                tl.to(button, {
                    scale: 0.9,
                    duration: 0.15,
                    ease: 'power2.out'
                })
                .to(button, {
                    scale: 1,
                    duration: 0.15,
                    ease: 'power2.out'
                })
                .to(window, {
                    duration: 1, /* Ajustar duración para coherencia */
                    scrollTo: {
                        y: '#intro',
                        offsetY: 80 /* Usar el offset ya establecido */
                    },
                    ease: 'power3.inOut'
                }, '-=0.1');
            });
        }
    });
</script>