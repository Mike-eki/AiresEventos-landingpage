---
import StarFill from "../icons/StarFill.astro";
import TitleTestiMonios from "../title-svgs/TitleTestiMonios.astro";
---

<section id="testimonios" class="testimonios-section-gsap">
    <hgroup class="title-container testimonios-titles-container-gsap">
        <div class="title testimonios-title-gsap">
            <TitleTestiMonios />
            <h2 style="display: none;">TESTI</h2>
            <h2 style="display: none;">MONIOS</h2>
        </div>
        <img class="main-img testimonios-main-img-gsap" src="images/testimony-main.webp" alt="Foto de dos personas disfrutando el momento">
        <div class="circle-container testimonios-circle-container-gsap">
            <svg class="testimonios-svg-gsap" viewBox="0 0 100 100">
                <defs>
                    <path id="circle" d="
                        M 50, 50
                        m -37, 0
                        a 37,37 0 1,1 74,0
                        a 37,37 0 1,1 -74,0"
                    />
                </defs>
                <text 
                    textLength="230"
                    lengthAdjust="spacingAndGlyphs"
                >
                    <textPath href="#circle" >
                        Clientes reales • Opiniones reales • Experiencias reales •
                    </textPath>
                </text>
            </svg>
        </div>
    </hgroup>

    <ul class="container-of-items testimonios-container-of-items-gsap">
        <li class="item-container r testimonios-item-container-gsap-1">
            <blockquote class="quote">
                <p>“Fui a un cumple de 15 y me sorprendió la recepción de bocaditos, variados, calientes y fríos. Ir con hambre y sin privarse en nada. Seguridad y buen trato del personal y mozos”.</p>
            </blockquote>
            <div class="author-container">
                <p class="author-name"><strong>Leonardo Santini</strong></p>
                <small class="author-detail">Agosto 2025 - Google</small>
                <div class="stars stars-gsap-1">
                    <StarFill />
                    <StarFill />
                    <StarFill />
                    <StarFill />
                    <StarFill />
                </div>
            </div>
        </li>
        
        <li class="item-container l testimonios-item-container-gsap-2">
            <div class="author-container-reverse">
                <p class="author-name"><strong>Carina Torres</strong></p>
                <small class="author-detail">Noviembre 2024 - Google</small>
                <div class="stars stars-gsap-2">
                    <StarFill />
                    <StarFill />
                    <StarFill />
                    <StarFill />
                    <StarFill />
                </div>
            </div>
            <blockquote class="quote">
                <p>“Tuvimos la graduación de mi hijo. Excelente lugar, atención, comida, bebida. Tuvimos un accidente con mi sobrina y la atención del personal, paramedicos y seguridad fue excelente. Super recomendable”.</p>
            </blockquote>
        </li>

        <li class="item-container r testimonios-item-container-gsap-3">
            <blockquote class="quote">
                <p>“Precioso salón de eventos de la ciudad de Rosario. Especial para graduaciones, casamientos y fiestas de fin de año empresariales. Muy buena comida, abundante, bebida de todo. Buena música. Es un salón caro pero lo vale”.</p>
            </blockquote>
            <div class="author-container">
                <p class="author-name"><strong>Javier Gustavo L.</strong></p>
                <small class="author-detail">Octubre 2024 - Google</small>
                <div class="stars stars-gsap-3">
                    <StarFill />
                    <StarFill />
                    <StarFill />
                    <StarFill />
                    <StarFill />
                </div>
            </div>
        </li>
    </ul>
</section>

<style>
    #testimonios {
        overflow: hidden;
    }
    ul, li {
        list-style: none;
        margin: 0;
        padding: 0;
    }
    blockquote {
        margin: 0;
    }
    img {
        display: block;
        width: 100%;
        object-fit: cover;
    }

    section {
        background-color: var(--light-beige);
    }

    .title-container {
        position: relative;
        display: flex;
        justify-content: flex-end;

        padding-inline: calc(var(--space) * 2);

        --min-font-size: 2rem;
        --max-font-size: 7rem;
        --min-viewport: 400px;
        --max-viewport: 1400px;

        padding-right: clamp(2rem, 0rem + 8vw, 7rem);
        
    }
    .title {
        position: absolute;
        z-index: 100000;
        left: 50%;
        transform: translateX(-50%);

        display: flex;
        flex-direction: column;
        gap: calc(var(--space) * 1.5);

        color: var(--violet-gum);

        --min-font-size: 3rem;
        --max-font-size: 7rem;
        --min-viewport: 375px;
        --max-viewport: 1400px;

        font-size: calc(
            var(--min-font-size) + 
            (var(--max-font-size) - var(--min-font-size)) * 
            ((100vw - var(--min-viewport)) / (var(--max-viewport) - var(--min-viewport)))
        );
    }

    .main-img {
        aspect-ratio: 2/3;
        max-width: 500px;
        border-radius: 50rem 50rem 0 0;

        margin-top: 6rem;
        margin-bottom: 3rem;
    }


    .container-of-items {
        display: flex;
        flex-direction: column;

        gap: calc(var(--space) * 3);
    }
    .item-container {
        display: flex;
        align-items: center;

        border-top: 4px solid var(--desert-sand);
        border-bottom: 4px solid var(--desert-sand);

    }
    .item-container.r {
        justify-content: right;
    }
    .item-container.l {
        justify-content: left;
    }
    .quote {
        width: 100%;
        display: flex;
        justify-content: center;
    }

    .quote p {
        max-width: 40ch;
        padding-inline: calc(var(--space) * 1.5);

        --min-font-size: 0.8rem;
        --max-font-size: 1rem;
        --min-viewport: 375px;
        --max-viewport: 1400px;

        font-size: clamp(0.8rem, 0.7268rem + 0.3122vw, 1rem);
    }

    .author-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: calc(var(--space) * 0.5);

        outline: 4px solid var(--desert-sand);

        --min-font-size: 1.5rem;
        --max-font-size: 4rem;
        --min-viewport: 375px;
        --max-viewport: 1400px;

        padding-inline: clamp(1.5rem, 0.5854rem + 3.9024vw, 4rem);

        : calc(var(--space) * 4);
        padding-block: calc(var(--space) * 4);

        border-radius: 100rem 0 0 100rem;
    }

    .author-name {
        text-wrap-mode: nowrap;

        --min-font-size: 1.2rem;
        --max-font-size: 1.6rem;
        --min-viewport: 375px;
        --max-viewport: 1400px;

        font-size: clamp(1.2rem, 1.0537rem + 0.6244vw, 1.6rem);
    }

    .stars {
        display: flex;
        gap: calc(var(--space) * 0.5);
    }


/*Reverse */

    .author-container-reverse {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: calc(var(--space) * 0.5);

        outline: 4px solid var(--desert-sand);

        --min-font-size: 1.5rem;
        --max-font-size: 4rem;
        --min-viewport: 375px;
        --max-viewport: 1400px;

        padding-inline: clamp(1.5rem, 0.5854rem + 3.9024vw, 4rem);


        padding-block: calc(var(--space) * 4);

        border-radius: 0 100rem 100rem 0;
    }


    @media screen and (max-width: 530px) {
        .item-container {
            flex-direction: column;
            border-bottom: none;
        }
        .item-container.l {
            flex-direction: column-reverse;
        }
        .author-container-reverse {
            padding-top: calc(var(--space) * 2);
            outline: none;
            border: 4px solid var(--desert-sand);
            border-radius: 0 0 100rem 100rem;
        }
        .quote {
            padding-block: calc(var(--space) * 2);
            outline: 4px solid var(--desert-sand);
            text-align: center;
        }
        .author-container {
            padding-top: calc(var(--space) * 2);
            outline: none;
            border: 4px solid var(--desert-sand);
            border-radius: 0 0 100rem 100rem;
        }
    }

    .circle-container {
        position: absolute;
        top: 70%;
        left: 50%;
        transform: translate(-50%, -50%);

        width: 15rem;
        height: 15rem;

        z-index: 15;
    }

    svg {
        shape-rendering: geometricPrecision;

        position: absolute;
        top: 0; left: 0;
        width: 100%;
        height: 100%;
        transform-origin: center;
    }

    @keyframes rotate {
        from {
            transform: rotate(0deg);
        }
        to {
            transform: rotate(360deg);
        }
    }

    text {
        will-change: transform;
        transform: translateZ(0);   /* crea una capa propia */
        text-rendering: optimizeLegibility;


        animation: rotate 20s linear infinite;
        transform-origin: 50% 50%;
        fill: var(--violet-gum);
        font-family: var(--font-switzer-light);
        font-size: 8px;
    }

</style>

<script>
  import { gsap } from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';
  
  gsap.registerPlugin(ScrollTrigger);
  
  // Animaciones cuando la sección entra en vista
  document.addEventListener('DOMContentLoaded', () => {
    // Animar el título SVG
    gsap.from('.testimonios-title-gsap svg', {
      scrollTrigger: {
        trigger: '.testimonios-titles-container-gsap',
        start: 'top 85%',
      },
      opacity: 0,
      y: 50,
      duration: 1.2,
      ease: 'power3.out'
    });
    
    // Animar la imagen principal
    gsap.from('.testimonios-main-img-gsap', {
      scrollTrigger: {
        trigger: '.testimonios-titles-container-gsap',
        start: 'top 80%',
      },
      opacity: 0,
      scale: 1.1,
      duration: 1.5,
      delay: 0.2,
      ease: 'power3.out'
    });
    
    // Animar el círculo con texto rotativo
    gsap.from('.testimonios-svg-gsap', {
      scrollTrigger: {
        trigger: '.testimonios-circle-container-gsap',
        start: 'top 90%',
      },
      opacity: 0,
      scale: 0,
      rotation: -180,
      duration: 1.5,
      ease: 'power3.out'
    });
    
    // Animar el primer testimonio (derecha)
    gsap.from('.testimonios-item-container-gsap-1', {
      scrollTrigger: {
        trigger: '.testimonios-item-container-gsap-1',
        start: 'top 90%',
      },
      opacity: 0,
      x: 100,
      duration: 1.2,
      ease: 'power3.out'
    });
    
    // Animar el segundo testimonio (izquierda)
    gsap.from('.testimonios-item-container-gsap-2', {
      scrollTrigger: {
        trigger: '.testimonios-item-container-gsap-2',
        start: 'top 90%',
      },
      opacity: 0,
      x: -100,
      duration: 1.2,
      ease: 'power3.out'
    });
    
    // Animar el tercer testimonio (derecha)
    gsap.from('.testimonios-item-container-gsap-3', {
      scrollTrigger: {
        trigger: '.testimonios-item-container-gsap-3',
        start: 'top 90%',
      },
      opacity: 0,
      x: 100,
      duration: 1.2,
      ease: 'power3.out'
    });
    
    // Animar las citas de los testimonios con stagger
    gsap.from('.quote', {
      scrollTrigger: {
        trigger: '.testimonios-container-of-items-gsap',
        start: 'top 85%',
      },
      opacity: 0,
      y: 30,
      duration: 1,
      stagger: 0.3,
      delay: 0.2,
      ease: 'power3.out'
    });
    
    // Animar los contenedores de autores
    gsap.from('.author-container, .author-container-reverse', {
      scrollTrigger: {
        trigger: '.testimonios-container-of-items-gsap',
        start: 'top 80%',
      },
      opacity: 0,
      scale: 0.9,
      duration: 1.1,
      stagger: 0.4,
      ease: 'power3.out'
    });
    
    // Animar las estrellas del primer testimonio
    gsap.from('.stars-gsap-1 svg', {
      scrollTrigger: {
        trigger: '.testimonios-item-container-gsap-1',
        start: 'top 85%',
      },
      opacity: 0,
      scale: 0,
      rotation: -180,
      duration: 0.8,
      stagger: 0.15,
      ease: 'back.out(1.7)'
    });
    
    // Animar las estrellas del segundo testimonio
    gsap.from('.stars-gsap-2 svg', {
      scrollTrigger: {
        trigger: '.testimonios-item-container-gsap-2',
        start: 'top 85%',
      },
      opacity: 0,
      scale: 0,
      rotation: 180,
      duration: 0.8,
      stagger: 0.15,
      ease: 'back.out(1.7)'
    });
    
    // Animar las estrellas del tercer testimonio
    gsap.from('.stars-gsap-3 svg', {
      scrollTrigger: {
        trigger: '.testimonios-item-container-gsap-3',
        start: 'top 85%',
      },
      opacity: 0,
      scale: 0,
      rotation: -180,
      duration: 0.8,
      stagger: 0.15,
      ease: 'back.out(1.7)'
    });

    ScrollTrigger.refresh();
  });
</script>